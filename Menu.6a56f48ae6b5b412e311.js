(window["jsonp-common-entrypoints"]=window["jsonp-common-entrypoints"]||[]).push([["auto/@etsy-modules/CategoryNav/Views/DropdownMenu/Menu"],{"2cvw":function(e,t,n){"use strict";n.r(t);n.d(t,"DropdownMenu",(function(){return f}));var i=n("Kyuy");var o=n("/wG7");var r=n("KWsK");var a=n("+s1y");var s=n("H3fw");var d=n("68KA");var l=n("YDjr");function u(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true}):e[t]=n;return e}const c={CONTEXT:".dropdown-category-menu",MENU_BODY:".dropdown-category-menu__body"};const h={KEY:"submenu",NAME:"Etsy\\Modules\\CategoryNav\\Specs\\DropdownCatNav\\DropdownSubmenu"};const p=2;const v=200;class f{constructor(){u(this,"context",null);u(this,"menu",null);u(this,"nodes",[]);u(this,"activeNodes",[]);u(this,"parentNodes",[]);this.context=document.querySelector(c.CONTEXT);this.loadSpec()}loadSpec(){o["default"].fetchOne(h.KEY,h.NAME,{},"GET",true).done((e=>{if(e.output&&e.output[h.KEY]){var t;const n=null===(t=this.context)||void 0===t?void 0:t.querySelector(o["default"].DEFAULT_PLACEHOLDER_SELECTOR);if(n){n.outerHTML=e.output[h.KEY];this.init()}}else r["default"].captureMessage("Desktop Category Submenu NeuSpec data.output not defined",{level:"info",extra:{specKey:h.KEY,specName:h.NAME,data:e}})}))}init(){if(!this.context)return;this.menu=new i["a"](this.context,{closeOnSelect:false,openDirectionHoriz:"left",openDirectionForce:true,openDirectionVert:"bottom",menuBodyBelowTrigger:true});this.nodes=this.parseNodes();this.activeNodes=this.nodes;this.parentNodes=[];this.bindEvents();this.bindTrackers()}findNode(e,t){return t.find((t=>t.node.id===e))}parseNodes(){var e;const t=[];null===(e=this.context)||void 0===e?void 0:e.querySelectorAll('[role="menuitem"]').forEach((e=>{if("undefined"!==typeof e.dataset.node)try{const n=JSON.parse(window.atob(e.dataset.node));n&&t.push(n)}catch(n){r["default"].captureMessage("Could not parse category node",{level:"info"});false;return}}));return t}bindEvents(){var e,t,n;null===(e=this.context)||void 0===e?void 0:e.addEventListener("click",this.handleClick.bind(this));null===(t=this.context)||void 0===t?void 0:t.addEventListener(l["c"].BEFORE_OPEN,(()=>{this.context instanceof HTMLElement&&d["Overlay"].dispatchOpenBackgroundOverlayIfEligible(this.context)}));null===(n=this.context)||void 0===n?void 0:n.addEventListener(l["c"].BEFORE_CLOSE,(()=>{this.context instanceof HTMLElement&&d["Overlay"].dispatchCloseBackgroundOverlayIfEligible(this.context)}))}bindTrackers(){var e,t;null===(e=this.context)||void 0===e?void 0:e.addEventListener("mouseenter",Object(a["default"])(this.handleMouseLeave.bind(this),v),true);null===(t=this.context)||void 0===t?void 0:t.addEventListener("click",this.handleClickTracker.bind(this))}handleMouseLeave(e){e.stopPropagation();const t=e.target;if(!(t instanceof HTMLElement)||"undefined"===typeof t.dataset.level)return;const n=parseInt(t.dataset.level);s["default"].logEvent({event_name:"catnav_dropdown_item_hover",level:n,is_parent_button:"undefined"!==typeof t.dataset.parentId})}handleClickTracker(e){const t=e.target;if(!(t instanceof HTMLElement))return;if("undefined"===typeof t.dataset.level)return;const n=parseInt(t.dataset.level);s["default"].logEvent({event_name:"catnav_dropdown_item_click",level:n,is_parent_button:"undefined"!==typeof t.dataset.parentId})}handleClick(e){const t=e.target;if(!(t instanceof HTMLElement))return;if(t.dataset.parentId){e.preventDefault();e.stopPropagation();this.handleParentClick();return}if(t instanceof HTMLAnchorElement){window.location.href=t.href;return}if("undefined"===typeof t.dataset.nodeId)return;const n=this.findNode(parseInt(t.dataset.nodeId),this.activeNodes);if(n){e.preventDefault();e.stopPropagation();this.activeNodes=n.children;this.parentNodes.push(n);this.renderNode(this.activeNodes)}}handleParentClick(){this.parentNodes.pop();const e=this.parentNodes[this.parentNodes.length-1];this.activeNodes=e?e.children:this.nodes;this.renderNode(this.activeNodes)}renderParent(){const e=this.parentNodes[this.parentNodes.length-1];if(!e)return"";const t=this.getLevel();return`<a\n            class="wt-menu__item wt-pl-xs-4 wt-arrow-link wt-arrow-link--back wt-text-title wt-bb-xs"\n            tabindex="-1"\n            data-parent-id="${e.node.id}"\n            role="menuitem"\n            data-level="${t}"\n            href="${e.node.url}"\n        >\n            ${e.node.name}\n        </a>`}getLevel(){return this.parentNodes.length+1}renderMenuItem(e){if(!e.node.name)return"";const t=this.getLevel();if(!e.has_children||t===p)return`<a \n                    href="${e.node.url}-${t}" \n                    class="wt-menu__item wt-text-black wt-text-truncate wt-width-full wt-pr-xs-7 wt-position-relative wt-max-width-full wt-display-inline-block "\n                    tabindex="-1"\n                    data-level="${t}"\n                    data-node-id="${e.node.id}"\n                    role="menuitem">${e.node.name}</a>`;return`<button \n            type="button" \n            class="wt-menu__item has-children wt-text-truncate wt-text-truncate wt-width-full wt-pr-xs-7 wt-position-relative wt-max-width-full wt-display-inline-block " \n            tabindex="-1"\n            data-level="${t}"\n            data-node-id="${e.node.id}"\n            role="menuitem"\n        >${e.node.name}</button>\n        `}renderNode(e){if(this.menu){var t;const i=null===(t=this.context)||void 0===t?void 0:t.querySelector(c.MENU_BODY);if(!i)return;i.innerHTML=this.renderParent()+e.map(this.renderMenuItem.bind(this)).join("");this.menu.menuCore.ui.items=i.querySelectorAll('[role="menuitem"]');if(i.firstElementChild instanceof HTMLElement){var n;null===(n=i.firstElementChild)||void 0===n?void 0:n.focus()}}}}}}]);
//# sourceMappingURL=https://www.etsy.com/sourcemaps/evergreenVendor/en-US/async/common-entrypoints/auto/@etsy-modules/CategoryNav/Views/DropdownMenu/Menu.6a56f48ae6b5b412e311.js.map